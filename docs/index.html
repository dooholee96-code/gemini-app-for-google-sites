<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íšŒì˜ë¡ ìë™ ì •ë¦¬ ì‹œìŠ¤í…œ</title>
    <meta name="theme-color" content="#e0e0ff"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --md-sys-color-primary: #3d5afe;
            --md-sys-color-on-primary: #ffffff;
            --md-sys-color-primary-container: #e0e0ff;
            --md-sys-color-on-primary-container: #001550;
            --md-sys-color-secondary: #595d72;
            --md-sys-color-on-secondary: #ffffff;
            --md-sys-color-secondary-container: #dde1f9;
            --md-sys-color-on-secondary-container: #161b2c;
            --md-sys-color-surface: #fdfbff;
            --md-sys-color-surface-variant: #e3e2e9;
            --md-sys-color-on-surface: #1b1b1f;
            --md-sys-color-on-surface-variant: #46464f;
            --md-sys-color-outline: #767680;
            --md-sys-color-success: #2e7d32;
            --md-sys-color-error: #b71c1c;
            --shadow-1: 0 1px 2px rgba(0,0,0,.08), 0 1px 1px rgba(0,0,0,.1);
            --shadow-2: 0 2px 4px rgba(0,0,0,.08), 0 2px 2px rgba(0,0,0,.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1.5rem; }
        .header { text-align: center; margin-bottom: 2rem; }
        .header p { font-size: 1.1rem; color: var(--md-sys-color-on-surface-variant); margin-top: 0.75rem; max-width: 650px; margin-left: auto; margin-right: auto; }
        .ai-global-settings { display: flex; flex-direction: column; align-items: center; gap: 0.75rem; margin-bottom: 2.5rem; }
        .panel { background: var(--md-sys-color-surface); border-radius: 16px; padding: 1.75rem; box-shadow: none; border: 1px solid var(--md-sys-color-outline-variant, #cac4d0); margin-bottom: 1.5rem; }
        .panel-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem; color: var(--md-sys-color-on-surface); }
        .main-content { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; align-items: flex-start; }
        .tab-group { display: flex; margin-bottom: 1.5rem; border-bottom: 1px solid var(--md-sys-color-surface-variant); }
        .tab-btn { padding: 0.75rem 1rem; border: none; background: none; cursor: pointer; font-size: 1rem; font-weight: 500; color: var(--md-sys-color-on-surface-variant); position: relative; transition: var(--transition); border-bottom: 2px solid transparent; }
        .tab-btn:hover { color: var(--md-sys-color-primary); }
        .tab-btn.active { color: var(--md-sys-color-primary); font-weight: 700; border-bottom: 2px solid var(--md-sys-color-primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .upload-area { display: block; border: 2px dashed var(--md-sys-color-outline); border-radius: 12px; padding: 3rem 1.5rem; text-align: center; transition: var(--transition); background: var(--md-sys-color-surface); position: relative; cursor: pointer; }
        .upload-area:hover, .upload-area.dragover { border-color: var(--md-sys-color-primary); background-color: var(--md-sys-color-primary-container); }
        .upload-icon { font-size: 2.5rem; color: var(--md-sys-color-primary); margin-bottom: 1rem; }
        .upload-text { font-size: 1rem; font-weight: 500; color: var(--md-sys-color-on-surface); margin-bottom: 0.25rem; }
        .upload-subtext { font-size: 0.875rem; color: var(--md-sys-color-on-surface-variant); }
        .file-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .file-success { margin-top: 1rem; padding: 0.75rem 1rem; background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); border-radius: 8px; font-weight: 500; text-align: center; }
        .toggle-container { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1.25rem; background: var(--md-sys-color-surface); border-radius: 16px; box-shadow: var(--shadow-1); border: 1px solid var(--md-sys-color-surface-variant); }
        .toggle-label { font-weight: 700; color: var(--md-sys-color-on-surface); display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;}
        .toggle-container.disabled { opacity: 0.6; cursor: not-allowed; }
        .toggle-container.disabled .toggle-switch { cursor: not-allowed; }
        .toggle-switch { position: relative; width: 52px; height: 32px; background: var(--md-sys-color-surface-variant); border-radius: 16px; cursor: pointer; transition: var(--transition); border: 2px solid var(--md-sys-color-outline); }
        .toggle-switch.active { background: var(--md-sys-color-primary); border-color: var(--md-sys-color-primary); }
        .toggle-slider { position: absolute; top: 4px; left: 4px; width: 16px; height: 16px; background: var(--md-sys-color-outline); border-radius: 50%; transition: var(--transition); }
        .toggle-switch.active .toggle-slider { transform: translateX(20px); background: var(--md-sys-color-on-primary); width: 24px; height: 24px; top: 2px; left: 2px; }
        .local-file-notice { background-color: var(--md-sys-color-secondary-container); color: var(--md-sys-color-on-secondary-container); padding: 0.75rem 1.25rem; border-radius: 12px; text-align: center; font-size: 0.9rem; font-weight: 500; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.6rem 1.2rem; border: 1px solid var(--md-sys-color-outline); border-radius: 20px; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: var(--transition); text-decoration: none; background-color: var(--md-sys-color-surface); color: var(--md-sys-color-primary); }
        .btn:hover { background-color: var(--md-sys-color-primary-container); border-color: var(--md-sys-color-primary); }
        .btn.primary { background-color: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); border-color: var(--md-sys-color-primary); }
        .btn.primary:hover { background-color: #304ffe; }
        .results-container { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .result-card { position: relative; min-height: 300px; display: flex; flex-direction: column; }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .action-buttons { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .result-content { flex-grow: 1; border: 1px solid var(--md-sys-color-surface-variant); border-radius: 12px; padding: 1.5rem; overflow-y: auto; font-size: 0.9375rem; line-height: 1.7; background: #fff; }
        .result-content:focus { outline: 2px solid var(--md-sys-color-primary); box-shadow: none; }
        .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--md-sys-color-on-surface-variant); text-align: center; padding: 2rem; }
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; color: var(--md-sys-color-secondary); }
        .spinner-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(253, 251, 255, 0.9); display: none; align-items: center; justify-content: center; flex-direction: column; gap: 1rem; z-index: 10; border-radius: 16px; }
        .spinner-container.show { display: flex; }
        .spinner { width: 32px; height: 32px; border: 4px solid var(--md-sys-color-primary); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner-text { font-weight: 500; color: var(--md-sys-color-on-surface); }
        .notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--md-sys-color-on-surface); color: var(--md-sys-color-surface); border-radius: 8px; padding: 1rem 1.5rem; box-shadow: var(--shadow-2); z-index: 1000; animation: slideUp 0.3s ease; opacity: 0; transition: opacity 0.3s; }
        .notification.show { opacity: 1; }
        @keyframes slideUp { from { transform: translate(-50%, 20px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .notification.success { background-color: var(--md-sys-color-success); color: white; }
        .notification.error { background-color: var(--md-sys-color-error); color: white; }
        .record-area { text-align: center; padding: 2rem 0; }
        .record-btn { background: none; border: none; cursor: pointer; padding: 0; }
        .record-btn .icon { font-size: 5rem; color: var(--md-sys-color-secondary-container); transition: var(--transition); }
        .record-btn:hover .icon { color: var(--md-sys-color-secondary); }
        .record-btn.recording .icon { color: var(--md-sys-color-error); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .record-status { font-weight: 500; color: var(--md-sys-color-on-surface-variant); margin-top: 1.5rem; height: 2rem; }
        .record-timer { font-size: 1.5rem; font-weight: 700; color: var(--md-sys-color-on-surface); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-content { background: var(--md-sys-color-surface); border-radius: 16px; padding: 2rem; max-width: 700px; width: 90%; max-height: 85vh; display: flex; flex-direction: column; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: var(--md-sys-color-on-surface); }
        .modal-body { flex-grow: 1; overflow-y: auto; background: #f9f9f9; border: 1px solid var(--md-sys-color-surface-variant); border-radius: 12px; padding: 1.5rem; white-space: pre-wrap; line-height: 1.7; color: var(--md-sys-color-on-surface-variant); }
        .modal-footer { margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.75rem; }
        @media (max-width: 1024px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <p>ìŒì„± ë˜ëŠ” í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì˜¬ë¦¬ë©´, AIê°€ íšŒì˜ë¡ì„ ìë™ ë¶„ì„í•˜ì—¬ ë‘ ê°€ì§€ ë²„ì „ìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤.</p>
        </header>
        <div class="ai-global-settings">
             <div id="localFileNotice" class="local-file-notice" style="display: none;">
                ğŸ’¡ AI ê¸°ëŠ¥ì€ ì›¹ì‚¬ì´íŠ¸ì— ê²Œì‹œ í›„ í™œì„±í™”ë©ë‹ˆë‹¤. (í˜„ì¬ ì˜¤í”„ë¼ì¸ ëª¨ë“œ)
            </div>
            <div class="toggle-container" id="toggleContainer">
                <label class="toggle-label">âœ¨ Gemini AI ì‚¬ìš©í•˜ê¸°</label>
                <div class="toggle-switch active" id="aiToggle">
                    <div class="toggle-slider"></div>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="input-column">
                <div class="tab-group" id="tabGroup">
                    <button class="tab-btn active" data-tab="transcript">íŒŒì¼ ì—…ë¡œë“œ</button>
                    <button class="tab-btn" data-tab="voice">ì‹¤ì‹œê°„ ë…¹ìŒ</button>
                </div>
                <div id="transcriptContent" class="tab-content active">
                    <div class="panel">
                        <label class="upload-area" id="uploadArea" for="fileInput">
                            <input type="file" id="fileInput" class="file-input" accept=".txt,text/plain,audio/*">
                            <div class="upload-icon">ğŸ“</div>
                            <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                            <div class="upload-subtext">ì§€ì› í˜•ì‹: í…ìŠ¤íŠ¸(.txt) ë˜ëŠ” ìŒì„± íŒŒì¼</div>
                        </label>
                        <div id="fileSuccess"></div>
                        <button class="btn primary" id="startProcessingBtn" style="display: none; margin-top: 1rem; width: 100%; justify-content: center;">ì •ë¦¬ ì‹œì‘</button>
                    </div>
                </div>
                <div id="voiceContent" class="tab-content">
                    <div class="panel">
                        <div class="record-area">
                            <button id="recordBtn" class="record-btn">
                                <span class="icon">ğŸ™ï¸</span>
                            </button>
                            <div id="recordStatus" class="record-status">
                                <div class="record-timer">00:00</div>
                                <div class="record-status-text">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒì„ ì‹œì‘í•˜ì„¸ìš”</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="results-container" id="resultsContainer">
                <div class="panel result-card" id="agendaResultCard">
                    <div class="result-header">
                        <h2 class="panel-title" style="margin: 0;">ğŸ“ ì•ˆê±´ë³„ ì •ë¦¬</h2>
                        <div class="action-buttons">
                            <button class="btn copy-btn" data-target="agenda" style="display: none;">ğŸ“‹ ë³µì‚¬</button>
                            <button class="btn download-btn" data-target="agenda" data-format="txt" style="display: none;">ğŸ’¾.txt</button>
                            <button class="btn download-btn" data-target="agenda" data-format="md" style="display: none;">ğŸ’¾.md</button>
                            <button class="btn email-btn primary" data-target="agenda" style="display: none;">âœ¨ í›„ì† ì´ë©”ì¼ ì´ˆì•ˆ</button>
                        </div>
                    </div>
                    <div class="result-content" id="agendaResultContent" contenteditable="true">
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ“‚</div>
                            <div>ì•ˆê±´ë³„ ì •ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                    <div class="spinner-container">
                        <div class="spinner"></div>
                        <div class="spinner-text">íšŒì˜ë¡ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
                <div class="panel result-card" id="chronoResultCard">
                     <div class="result-header">
                        <h2 class="panel-title" style="margin: 0;">â° ì‹œê°„ìˆœ ì •ë¦¬</h2>
                        <div class="action-buttons">
                            <button class="btn copy-btn" data-target="chrono" style="display: none;">ğŸ“‹ ë³µì‚¬</button>
                            <button class="btn download-btn" data-target="chrono" data-format="txt" style="display: none;">ğŸ’¾.txt</button>
                            <button class="btn download-btn" data-target="chrono" data-format="md" style="display: none;">ğŸ’¾.md</button>
                             <button class="btn email-btn primary" data-target="chrono" style="display: none;">âœ¨ í›„ì† ì´ë©”ì¼ ì´ˆì•ˆ</button>
                        </div>
                    </div>
                    <div class="result-content" id="chronoResultContent" contenteditable="true">
                        <div class="empty-state">
                             <div class="empty-icon">ğŸ•’</div>
                            <div>ì‹œê°„ìˆœ ì •ë¦¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                    <div class="spinner-container">
                        <div class="spinner"></div>
                        <div class="spinner-text">íšŒì˜ë¡ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="emailModalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">âœ‰ï¸ AI í›„ì† ì´ë©”ì¼ ì´ˆì•ˆ</h3>
            </div>
            <div class="modal-body" id="emailModalBody">
                <div class="spinner-container show">
                    <div class="spinner"></div>
                    <div class="spinner-text">ì´ë©”ì¼ ì´ˆì•ˆì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="emailModalCloseBtn">ë‹«ê¸°</button>
                <button class="btn primary" id="emailModalCopyBtn">ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
            </div>
        </div>
    </div>
    <script>
        const state = {
            file: null, audioBlob: null, rawContent: '', meetingTitle: '',
            agendaResult: { markdown: '', html: '' }, chronoResult: { markdown: '', html: '' },
            processing: false, aiEnabled: true, isRecording: false,
            mediaRecorder: null, audioChunks: [], timerInterval: null, summarizerWorker: null
        };
        const elements = {
            aiToggle: document.getElementById('aiToggle'),
            toggleContainer: document.getElementById('toggleContainer'),
            localFileNotice: document.getElementById('localFileNotice'),
            uploadArea: document.getElementById('uploadArea'),
            fileInput: document.getElementById('fileInput'),
            fileSuccess: document.getElementById('fileSuccess'),
            startProcessingBtn: document.getElementById('startProcessingBtn'),
            tabGroup: document.getElementById('tabGroup'),
            transcriptContent: document.getElementById('transcriptContent'),
            voiceContent: document.getElementById('voiceContent'),
            recordBtn: document.getElementById('recordBtn'),
            recordStatus: document.getElementById('recordStatus'),
            recordTimer: document.querySelector('.record-timer'),
            recordStatusText: document.querySelector('.record-status-text'),
            resultsContainer: document.getElementById('resultsContainer'),
            agendaResult: { card: document.getElementById('agendaResultCard'), content: document.getElementById('agendaResultContent'), spinner: document.querySelector('#agendaResultCard .spinner-container'), buttons: document.querySelectorAll('#agendaResultCard .action-buttons button') },
            chronoResult: { card: document.getElementById('chronoResultCard'), content: document.getElementById('chronoResultContent'), spinner: document.querySelector('#chronoResultCard .spinner-container'), buttons: document.querySelectorAll('#chronoResultCard .action-buttons button') },
            emailModal: { overlay: document.getElementById('emailModalOverlay'), body: document.getElementById('emailModalBody'), copyBtn: document.getElementById('emailModalCopyBtn'), closeBtn: document.getElementById('emailModalCloseBtn') }
        };
        const summarizerWorkerScript = "const KOREAN_STOPWORDS=new Set(['ì•„','íœ´','ì•„ì´êµ¬','ì•„ì´ì¿ ','ì•„ì´ê³ ','ì–´','ë‚˜','ìš°ë¦¬','ì €í¬','ë”°ë¼','ì˜í•´','ì„','ë¥¼','ì—','ì˜','ê°€','ì´','ì€','ëŠ”','ì¢€','ì˜','ê±','ê³¼','ë„','ì„','ë¥¼','ìœ¼ë¡œ','ì','ì—','ì™€','í•œ','í•˜ë‹¤','ê·¸ë¦¬ê³ ','ê·¸ë˜ì„œ','ê·¸ëŸ¬ë‚˜','ê·¸ëŸ¬ë¯€ë¡œ','ê·¸ëŸ°ë°','í•˜ì§€ë§Œ','ê·¸ëŸ¼','ë˜','ë˜í•œ','ì´','ê·¸','ì €','ê²ƒ','ìˆ˜','ë“±','ë“¤','ë°','ì…ë‹ˆë‹¤','ìŠµë‹ˆë‹¤','í•©ë‹ˆë‹¤','í•˜ê³ ','ì—ì„œ','ë˜','ìˆ','í•˜','ê°™','ì—†','ì£¼','ë…„','ì›”','ì¼','ì‹œ','ë¶„','ì´ˆ','ì¢€','ë”','ë§','í°','ì‘','ë•Œë¬¸','í†µí•´','ë°”ë¡œ','ì •ë§','ë§¤ìš°','ì•„ì£¼','í•˜ë‚˜','ë‘˜','ì…‹','ë„·','ë‹¤ì„¯','ì—¬ì„¯','ì¼ê³±','ì—¬ëŸ','ì•„í™‰','ì—´']);let agendaKeywords={'ë§ˆì¼€íŒ…/í™ë³´':['ë§ˆì¼€íŒ…','í™ë³´','ê´‘ê³ ','ìº í˜ì¸','SNS','ê³ ê°','ìœ ì…'],'ì¬ë¬´/ì˜ˆì‚°':['ì˜ˆì‚°','ë¹„ìš©','ìˆ˜ìµ','ë§¤ì¶œ','íˆ¬ì','ì¬ë¬´','ê²°ì‚°'],'ì¸ì‚¬/ì¡°ì§':['ì±„ìš©','ì¸ì‚¬','ì¡°ì§','íŒ€','ì—­í• ','í‰ê°€','ë³´ìƒ'],'ê°œë°œ/ê¸°ìˆ ':['ê°œë°œ','ê¸°ìˆ ','ì‹œìŠ¤í…œ','ì„œë²„','ì—…ë°ì´íŠ¸','ë¦´ë¦¬ì¦ˆ','ë²„ê·¸'],'ì‚¬ì—…/ì „ëµ':['ì‚¬ì—…','ì „ëµ','ì‹ ì œí’ˆ','ì¶œì‹œ','ë¡œë“œë§µ','ëª©í‘œ','KPI']};function tokenize(text){return text.toLowerCase().match(new RegExp('[ê°€-í£a-zA-Z0-9]+','g'))||[]}function calculateWordFrequencies(tokens){const freqs={};for(const token of tokens){if(!KOREAN_STOPWORDS.has(token)&&token.length>1){freqs[token]=(freqs[token]||0)+1}}return freqs}function getKeywords(freqs,count=5){return Object.entries(freqs).sort((a,b)=>b[1]-a[1]).slice(0,count).map(e=>e[0])}function scoreSentences(stmts,freqs){return stmts.map(stmt=>({speaker:stmt.speaker,sentences:(stmt.content.match(new RegExp('[^.!?]+[.!?]*','g'))||[]).map(s=>({text:s.trim(),score:tokenize(s).reduce((acc,t)=>acc+(freqs[t]||0),0)}))}))}function parseContent(content){const speakers=new Set,statements=[],lines=content.split('\\n');let currentSpeaker='ë¯¸ìƒ',currentContent='';const speakerRegex=new RegExp('^\\\\[?(ì°¸ì„ì|ë°œí™”ì|í™”ì|Speaker)\\\\s*(\\\\d+|\\\\w+)\\\\]?[:\\\\s]'),timestampRegex=new RegExp('\\\\d{2}:\\\\d{2}(?::\\\\d{2})?'),flush=()=>{const trimmed=currentContent.trim();if(trimmed){speakers.add(currentSpeaker);statements.push({speaker:currentSpeaker,content:trimmed})}currentContent=''};for(const line of lines){const trimmedLine=line.trim();if(!trimmedLine)continue;const match=trimmedLine.match(speakerRegex);if(match){flush();currentSpeaker=match[1]+' '+match[2];currentContent=trimmedLine.substring(match[0].length).trim()}else{currentContent+=(currentContent?' ':'')+trimmedLine.replace(timestampRegex,'').trim()}}flush();if(statements.length===0&&content.trim()){statements.push({speaker:'ë‚´ìš©',content:content.trim()});speakers.add('ë‚´ìš©')}return{speakers:Array.from(speakers),statements}}function extractActionItems(stmts){const items=[],keywords=['ê¹Œì§€','ë‹´ë‹¹','ì²˜ë¦¬','ë³´ê³ ','ì™„ë£Œ','ì¤€ë¹„','í•´ì•¼','í•©ë‹ˆë‹¤','í•˜ê¸°ë¡œ','í•˜ë„ë¡'],sentenceRegex=new RegExp('[^.!?]+[.!?]*','g'),datePattern=new RegExp('(\\\\d{1,2}ì›”\\\\s*\\\\d{1,2}ì¼|\\\\d{1,2}\\\\/\\\\d{1,2}|ë‹¤ìŒ\\\\s?ì£¼|ë‚´ì¼|ì´ë²ˆ\\\\s?ì£¼\\\\s?ë§)'),personPattern=new RegExp('(\\\\S+)(?:ë‹˜|ê»˜ì„œ|ì”¨|ê°€|ì´)\\\\s');stmts.forEach(stmt=>{(stmt.content.match(sentenceRegex)||[stmt.content]).forEach(s=>{if(keywords.some(k=>s.includes(k))){let person=(s.match(personPattern)||[])[1]||stmt.speaker;if(['ë¯¸ìƒ','ë‚´ìš©'].includes(person))person='ë‹´ë‹¹ì ë¯¸ì§€ì •';const deadline=(s.match(datePattern)||[])[0]||'ê¸°í•œ ë¯¸ì§€ì •';if(s.trim().length<100)items.push('[ ] '+s.trim()+' (ë‹´ë‹¹: '+person+', ê¸°í•œ: '+deadline+')')}})});return[...new Set(items)]}function classifyAgendas(stmts){const classified={},unclassified=[];stmts.forEach(stmt=>{const tokens=tokenize(stmt.content);let bestAgenda=null,maxScore=0;for(const agenda in agendaKeywords){const score=tokens.reduce((acc,token)=>acc+(agendaKeywords[agenda].includes(token)?1:0),0);if(score>maxScore){maxScore=score;bestAgenda=agenda}}if(maxScore>0){if(!classified[bestAgenda])classified[bestAgenda]=[];classified[bestAgenda].push(stmt)}else{unclassified.push(stmt)}});const groups=Object.entries(classified).map(([title,statements])=>({title,statements}));if(unclassified.length>0)groups.push({title:'ê¸°íƒ€ ë…¼ì˜',statements:unclassified});return groups.length>0?groups:[{title:'ì „ì²´ íšŒì˜ ë‚´ìš©',statements:stmts}]}function generateBasicMarkdown(text,title,useTemplate){if(!text||!text.trim())return'# '+title+'\\n\\në‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';const{statements}=parseContent(text),freqs=calculateWordFrequencies(tokenize(text)),summary=(scoreSentences(statements,freqs).flatMap(s=>s.sentences).sort((a,b)=>b.score-a.score)[0]||{}).text||'í•µì‹¬ ìš”ì•½ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',keywords=getKeywords(freqs,5),actionItems=extractActionItems(statements);let md='# '+title+' (ì˜¤í”„ë¼ì¸ ìš”ì•½)\\n\\n## ğŸ“ í•œ ì¤„ ìš”ì•½\\n'+summary+'\\n\\n## ğŸ”‘ í•µì‹¬ í‚¤ì›Œë“œ\\n- '+keywords.join(', ')+'\\n\\n## âœ… ì‹¤í–‰ í•­ëª© (Action Items)\\n';md+=(actionItems.length>0?actionItems.map(item=>'- '+item).join('\\n'):'ì¶”ì¶œëœ ì‹¤í–‰ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.')+'\\n\\n';md+='## ğŸ’¬ ìƒì„¸ ë‚´ìš©\\n';const groups=useTemplate?classifyAgendas(statements):[{title:'ì‹œê°„ìˆœ ë°œì–¸ ë‚´ìš©',statements}];if(groups.length>0){groups.forEach(g=>{md+='### '+g.title+'\\n';md+=g.statements.map(s=>'**'+s.speaker+':** '+s.content).join('\\n\\n')+'\\n\\n'})}else{md+='ì •ë¦¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.\\n'}return md}self.onmessage=e=>{const{type,payload}=e.data;if(type==='summarize'){try{const{textContent,title,useTemplate}=payload,markdown=generateBasicMarkdown(textContent,title,useTemplate);self.postMessage({type:'summarize_result',payload:{markdown}})}catch(err){self.postMessage({type:'error',payload:{message:err.message}})}}else if(type==='update_keywords'){const learned=payload.keywords;for(const cat in learned){if(!agendaKeywords[cat])agendaKeywords[cat]=[];const newSet=new Set([...agendaKeywords[cat],...learned[cat]]);agendaKeywords[cat]=Array.from(newSet)}}};";
        
        function showSpinners(text) { [elements.agendaResult, elements.chronoResult].forEach(result => { result.spinner.querySelector('.spinner-text').textContent = text; result.spinner.classList.add('show'); result.content.innerHTML = ''; }); }
        function hideSpinners() { [elements.agendaResult, elements.chronoResult].forEach(result => { result.spinner.classList.remove('show'); }); }
        function showNotification(message, type = 'success') { const notification = document.createElement('div'); notification.className = "notification " + type; notification.textContent = message; document.body.appendChild(notification); setTimeout(() => notification.classList.add('show'), 10); setTimeout(() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 3000); }, 3000); }
        function handleFile(file) { try { if (!file) return; state.file = file; state.meetingTitle = file.name.split('.').slice(0, -1).join('.') || file.name; elements.fileSuccess.innerHTML = '<div class="file-success">âœ… ' + file.name + '</div>'; elements.startProcessingBtn.style.display = 'inline-flex'; if (file.type.startsWith('audio/')) { state.audioBlob = file; state.rawContent = ''; } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) { const reader = new FileReader(); reader.onload = e => { state.rawContent = e.target.result; state.audioBlob = null; }; reader.onerror = () => showNotification('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜', 'error'); reader.readAsText(file, 'UTF-8'); } else { showNotification('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: ' + (file.type || 'ì•Œ ìˆ˜ ì—†ìŒ'), 'error'); elements.fileSuccess.innerHTML = ''; elements.startProcessingBtn.style.display = 'none'; } } catch (error) { showNotification('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); } }
        async function startProcessing() { if (state.processing) return; state.processing = true; elements.startProcessingBtn.style.display = 'none'; elements.fileSuccess.innerHTML = ''; const isAudio = !!state.audioBlob; if (isAudio && !state.aiEnabled) { showNotification('ìŒì„± íŒŒì¼ì€ AI ì‚¬ìš© ëª¨ë“œì—ì„œë§Œ ì²˜ë¦¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error'); state.processing = false; return; } showSpinners(isAudio ? 'ìŒì„± ë¶„ì„ ë° íšŒì˜ë¡ ì •ë¦¬ ì¤‘...' : 'íšŒì˜ë¡ ì •ë¦¬ ì¤‘...'); try { const [agendaResult, chronoResult] = await Promise.all([generateReport(true), generateReport(false)]); state.agendaResult = agendaResult; state.chronoResult = chronoResult; elements.agendaResult.content.innerHTML = agendaResult.html; elements.chronoResult.content.innerHTML = chronoResult.html; document.querySelectorAll('.action-buttons button').forEach(b => b.style.display = 'inline-flex'); showNotification('íšŒì˜ë¡ ì •ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'); } catch (error) { console.error('Processing Error:', error); showNotification('ì˜¤ë¥˜: ' + error.message, 'error'); const errorHtml = '<div class="empty-state">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>'; elements.agendaResult.content.innerHTML = errorHtml; elements.chronoResult.content.innerHTML = errorHtml; } finally { state.processing = false; } }
        async function generateReport(useTemplate, taskPrompt) { if (state.aiEnabled) { const prompt = taskPrompt || createAIPrompt(state.rawContent, state.meetingTitle, useTemplate); const requestBody = { contents: [{ parts: [{ text: prompt }] }] }; if (state.audioBlob) { const base64Audio = await blobToBase64(state.audioBlob); requestBody.contents[0].parts.push({ inline_data: { mime_type: state.audioBlob.type, data: base64Audio } }); } try { const markdown = await callProxyAPI(requestBody); if(!markdown) throw new Error("APIë¡œë¶€í„° ë¹ˆ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤."); const html = formatMarkdownToHtml(markdown); return { markdown, html }; } catch (error) { console.error("API Call failed:", error); showNotification("API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message, "error"); const mockMarkdown = getMockMarkdown(prompt.includes("ì´ë©”ì¼ ì´ˆì•ˆ")); const mockHtml = formatMarkdownToHtml(mockMarkdown); return { markdown: mockMarkdown, html: mockHtml, isMock: true }; } } else { return new Promise((resolve, reject) => { const handleWorkerMessage = (event) => { const { type, payload } = event.data; state.summarizerWorker.removeEventListener('message', handleWorkerMessage); if (type === 'error') { reject(new Error(payload.message)); } else if (type === 'summarize_result') { const html = formatMarkdownToHtml(payload.markdown); resolve({ markdown: payload.markdown, html }); } }; state.summarizerWorker.addEventListener('message', handleWorkerMessage); state.summarizerWorker.postMessage({ type: 'summarize', payload: { textContent: state.rawContent, title: state.meetingTitle, useTemplate } }); }); } }
        function getMockMarkdown(isEmail) { const title = state.meetingTitle || "ìƒ˜í”Œ íšŒì˜"; if (isEmail) { return `[AI ëª©ì—… ì‘ë‹µ]\n\nì œëª©: ${title} íšŒì˜ í›„ì† ì¡°ì¹˜ ì•ˆë‚´\n\nì•ˆë…•í•˜ì„¸ìš”, [ì´ë¦„]ì…ë‹ˆë‹¤.\n\nì§€ë‚œ ${title} íšŒì˜ì— ì°¸ì„í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\nì£¼ìš” ë…¼ì˜ ì‚¬í•­ê³¼ ê²°ì •ëœ ì‹¤í–‰ í•­ëª©ì„ ì•„ë˜ì™€ ê°™ì´ ê³µìœ ë“œë¦½ë‹ˆë‹¤.\n\n- ì‹¤í–‰ í•­ëª© 1\n- ì‹¤í–‰ í•­ëª© 2\n\nê°ì‚¬í•©ë‹ˆë‹¤.\n[ì´ë¦„] ë“œë¦¼`; } else { return `# ${title} (AI ëª©ì—… ì‘ë‹µ)\n\n## íšŒì˜ ê°œìš”\nAI í˜¸ì¶œì— ì‹¤íŒ¨í•˜ì—¬ ëª©ì—… ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤. API í‚¤ ë˜ëŠ” í”„ë¡ì‹œ ì„œë²„ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\n\n## ì‹¤í–‰ í•­ëª© (Action Items)\n- [ ] ë‹´ë‹¹ì 1: ëª©ì—… ë°ì´í„° í™•ì¸í•˜ê¸° (ê¸°í•œ: ì¦‰ì‹œ)\n\n## ìƒì„¸ ë‚´ìš©\nì´ ë‚´ìš©ì€ ì‹¤ì œ AIê°€ ìƒì„±í•œ ê²ƒì´ ì•„ë‹ˆë©°, ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ ì‹œ UI í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í‘œì‹œë˜ëŠ” ì„ì‹œ ë°ì´í„°ì…ë‹ˆë‹¤.`; } }
        function createAIPrompt(content, title, useTemplate) { const templateInstruction = useTemplate ? "1. **ì•ˆê±´ ì¶”ì¶œ**: íšŒì˜ ë‚´ìš©ì—ì„œ í•µì‹¬ ì•ˆê±´ì„ 3~5ê°œ ì¶”ì¶œí•©ë‹ˆë‹¤.\n2. **ì•ˆê±´ë³„ ì •ë¦¬**: ê° ì•ˆê±´ì— ëŒ€í•´ ì£¼ìš” ë‚´ìš©, ê²°ì • ì‚¬í•­, í•µì‹¬ ë°œì–¸ì„ ì •ë¦¬í•©ë‹ˆë‹¤." : "ì‹œê°„ìˆœìœ¼ë¡œ ë°œì–¸ ë‚´ìš©ì„ ìš”ì•½í•˜ê³  ì •ë¦¬í•©ë‹ˆë‹¤. ë°œì–¸ìë¥¼ ëª…ì‹œí•˜ê³ , ë¶ˆí•„ìš”í•œ ë¶€ë¶„ì€ ì œê±°í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì—¬ì£¼ì„¸ìš”."; let prompt = "ë‹¹ì‹ ì€ íšŒì˜ë¡ ì •ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì§€ì •ëœ í˜•ì‹ì— ë§ì¶° ëª…í™•í•˜ê³  ê°„ê²°í•œ í•œêµ­ì–´ Markdown íšŒì˜ë¡ì„ ìƒì„±í•´ì£¼ì„¸ìš”.\n\n**íšŒì˜ ì œëª©**: " + title + "\n\n**ì •ë¦¬ í˜•ì‹**:\n- **íšŒì˜ ê°œìš”**: íšŒì˜ì˜ ëª©ì ê³¼ í•µì‹¬ ê²°ê³¼ë¥¼ 1~2 ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.\n- **ì‹¤í–‰ í•­ëª© (Action Items)**: ëˆ„ê°€, ë¬´ì—‡ì„, ì–¸ì œê¹Œì§€ í•´ì•¼ í•˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ì •ë¦¬ëœ í•  ì¼ ëª©ë¡ì…ë‹ˆë‹¤. í•­ëª©ì´ ì—†ë‹¤ë©´ 'í•´ë‹¹ ì—†ìŒ'ìœ¼ë¡œ í‘œì‹œí•´ì£¼ì„¸ìš”.\n- **í™”ìë³„ ì£¼ìš” ë°œì–¸**: í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ í™”ìë¥¼ 'ì°¸ì„ì 1', 'ì°¸ì„ì 2' ë“±ìœ¼ë¡œ êµ¬ë¶„í•˜ê³ , ê° í™”ìì˜ í•µì‹¬ ë°œì–¸ì„ 1~2ê°œì”© ìš”ì•½í•©ë‹ˆë‹¤.\n- **ìƒì„¸ ë‚´ìš©**:\n    " + templateInstruction; if (content) prompt += "\n\n**ì›ë³¸ íšŒì˜ë¡**:\n---\n" + content + "\n---"; return prompt; }
        
        async function callProxyAPI(requestBody) {
            // ===================================================================================
            // â—ï¸â—ï¸â—ï¸ ì—¬ê¸°ê°€ ë°”ë¡œ ìˆ˜ì •í•  ìœ„ì¹˜ì…ë‹ˆë‹¤! â—ï¸â—ï¸â—ï¸
            // ì•„ë˜ì˜ í°ë”°ì˜´í‘œ ì•ˆì— Deno Deployì˜ Production URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
            // ===================================================================================
            const url = "https://gemini-app-for-google-sites.dooholee96-code.deno.net/"; 

            const response = await fetch(url, { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify(requestBody) 
            }); 
            
            if (!response.ok) { 
                const errorData = await response.json(); 
                throw new Error(errorData.error?.message || `API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
            } 
            
            const data = await response.json(); 
            return data.candidates?.[0]?.content?.parts?.[0]?.text; 
        }

        const formatMarkdownToHtml = markdownText => { if (!markdownText) return '<div class="empty-state">ê²°ê³¼ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>'; return markdownText.replace(/^### (.*$)/gim, '<h4>$1</h4>').replace(/^## (.*$)/gim, '<h3>$1</h3>').replace(/^# (.*$)/gim, '<h2>$1</h2>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\[ \]/g, 'â¬œ').replace(/\[x\]/g, 'âœ…').replace(/^\s*-\s*\[\s*\]\s*(.*$)/gim, '<li>â¬œ $1</li>').replace(/^\s*-\s*(?!\[)(.*$)/gim, '<li>$1</li>').replace(/<\/li><li>/g, '</li>\n<li>').replace(/\n/g, '<br>'); }
        const blobToBase64 = blob => new Promise((resolve, reject) => { const reader = new FileReader(); reader.onloadend = () => resolve(reader.result.split(',')[1]); reader.onerror = reject; reader.readAsDataURL(blob); });
        function handleCopy(e) { const target = e.currentTarget.dataset.target; navigator.clipboard.writeText(elements[target + 'Result'].content.innerText) .then(() => showNotification('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')) .catch(() => showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error')); }
        function handleDownload(e) { const target = e.currentTarget.dataset.target; const format = e.currentTarget.dataset.format; const isMarkdown = format === 'md'; const content = isMarkdown ? state[target + 'Result'].markdown : elements[target + 'Result'].content.innerText; const mimeType = isMarkdown ? 'text/markdown;charset=utf-8' : 'text/plain;charset=utf-8'; const fileName = state.meetingTitle + '-' + target + '.' + format; const blob = new Blob([content], { type: mimeType }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); showNotification("'" + fileName + "' ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.", 'success'); }
        async function handleGenerateEmail(e) { const target = e.currentTarget.dataset.target; const markdown = state[target + 'Result'].markdown; if (!markdown) { showNotification('ì´ë©”ì¼ì„ ìƒì„±í•  íšŒì˜ë¡ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; } elements.emailModal.overlay.classList.add('show'); elements.emailModal.body.innerHTML = '<div class="spinner-container show"><div class="spinner"></div><div class="spinner-text">ì´ë©”ì¼ ì´ˆì•ˆì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...</div></div>'; const prompt = `ë‹¹ì‹ ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ íšŒì˜ë¡ ìš”ì•½ë³¸ì„ ë°”íƒ•ìœ¼ë¡œ, íšŒì˜ ì°¸ì„ìë“¤ì—ê²Œ ë³´ë‚´ëŠ” ì „ë¬¸ì ì¸ í›„ì† ì¡°ì¹˜ ì´ë©”ì¼ ì´ˆì•ˆì„ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ì´ë©”ì¼ì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:\n\n1. ê°„ë‹¨í•œ ì¸ì‚¬ì™€ íšŒì˜ ì£¼ì œ ì–¸ê¸‰\n2. ë…¼ì˜ëœ í•µì‹¬ ê²°ì • ì‚¬í•­ ìš”ì•½\n3. ì‹¤í–‰ í•­ëª©(Action Items)ì„ ëª…í™•í•œ ëª©ë¡ í˜•íƒœë¡œ ì •ë¦¬ (ë‹´ë‹¹ì, ê¸°í•œ í¬í•¨)\n4. ë§ˆë¬´ë¦¬ ì¸ì‚¬\n\nì „ì²´ì ìœ¼ë¡œ ê°„ê²°í•˜ê³  í”„ë¡œí˜ì…”ë„í•œ í†¤ì„ ìœ ì§€í•´ì£¼ì„¸ìš”.\n\n**íšŒì˜ë¡ ìš”ì•½:**\n---\n${markdown}\n---`; try { const requestBody = { contents: [{ parts: [{ text: prompt }] }] }; const emailDraft = await callProxyAPI(requestBody); if(!emailDraft) throw new Error("APIë¡œë¶€í„° ë¹ˆ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤."); elements.emailModal.body.innerText = emailDraft; } catch (error) { elements.emailModal.body.innerText = 'ì´ë©”ì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message; showNotification("ì´ë©”ì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error"); } }
        function startTimer() { let seconds = 0; elements.recordTimer.textContent = '00:00'; state.timerInterval = setInterval(() => { seconds++; const min = String(Math.floor(seconds / 60)).padStart(2, '0'); const sec = String(seconds % 60).padStart(2, '0'); elements.recordTimer.textContent = min + ':' + sec; }, 1000); }
        function stopTimer() { clearInterval(state.timerInterval); }
        async function startRecording() { try { const stream = await navigator.mediaDevices.getUserMedia({ audio: true }); state.isRecording = true; elements.recordBtn.classList.add('recording'); elements.recordStatusText.textContent = 'ë…¹ìŒ ì¤‘... ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¤‘ì§€'; startTimer(); state.audioChunks = []; state.mediaRecorder = new MediaRecorder(stream); state.mediaRecorder.ondataavailable = e => state.audioChunks.push(e.data); state.mediaRecorder.onstop = () => { const audioBlob = new Blob(state.audioChunks, { type: 'audio/webm' }); state.audioBlob = audioBlob; state.rawContent = ''; const now = new Date(); state.meetingTitle = 'ë…¹ìŒ-' + now.getFullYear() + String(now.getMonth()+1).padStart(2,'0') + String(now.getDate()).padStart(2,'0') + '-' + String(now.getHours()).padStart(2,'0') + String(now.getMinutes()).padStart(2,'0'); elements.fileSuccess.innerHTML = '<div class="file-success">âœ… ' + state.meetingTitle + '.webm (ë…¹ìŒ ì™„ë£Œ)</div>'; stream.getTracks().forEach(track => track.stop()); startProcessing(); }; state.mediaRecorder.start(); } catch (err) { showNotification('ë§ˆì´í¬ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error'); } }
        function stopRecording() { if (state.mediaRecorder?.state === 'recording') state.mediaRecorder.stop(); state.isRecording = false; elements.recordBtn.classList.remove('recording'); elements.recordStatusText.textContent = 'ë²„íŠ¼ì„ ëˆŒëŸ¬ ë…¹ìŒì„ ì‹œì‘í•˜ì„¸ìš”'; stopTimer(); }
        function setupEventListeners() { elements.aiToggle.addEventListener('click', () => { if (elements.toggleContainer.classList.contains('disabled')) return; state.aiEnabled = !state.aiEnabled; elements.aiToggle.classList.toggle('active', state.aiEnabled); showNotification(state.aiEnabled ? 'Gemini AI ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì˜¤í”„ë¼ì¸ ìš”ì•½ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success'); }); elements.tabGroup.addEventListener('click', e => { if (e.target.tagName !== 'BUTTON') return; elements.tabGroup.querySelector('.active').classList.remove('active'); e.target.classList.add('active'); elements.transcriptContent.classList.toggle('active', e.target.dataset.tab === 'transcript'); elements.voiceContent.classList.toggle('active', e.target.dataset.tab === 'voice'); }); elements.fileInput.addEventListener('change', (event) => { if (event.target.files.length > 0) handleFile(event.target.files[0]); }); elements.startProcessingBtn.addEventListener('click', startProcessing); ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => { elements.uploadArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); elements.uploadArea.classList.toggle('dragover', ['dragenter', 'dragover'].includes(eventName)); if (eventName === 'drop' && e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]); }); }); elements.recordBtn.addEventListener('click', () => { state.isRecording ? stopRecording() : startRecording(); }); elements.resultsContainer.addEventListener('click', e => { const targetBtn = e.target.closest('button'); if (!targetBtn) return; if (targetBtn.classList.contains('copy-btn')) handleCopy(e); else if (targetBtn.classList.contains('download-btn')) handleDownload(e); else if (targetBtn.classList.contains('email-btn')) handleGenerateEmail(e); }); elements.emailModal.closeBtn.addEventListener('click', () => { elements.emailModal.overlay.classList.remove('show'); }); elements.emailModal.copyBtn.addEventListener('click', () => { navigator.clipboard.writeText(elements.emailModal.body.innerText) .then(() => showNotification('ì´ë©”ì¼ ì´ˆì•ˆì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')) .catch(() => showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error')); }); }
        document.addEventListener('DOMContentLoaded', () => { const isLocalFile = window.location.protocol === 'file:'; if (isLocalFile) { state.aiEnabled = false; elements.aiToggle.classList.remove('active'); elements.toggleContainer.classList.add('disabled'); elements.localFileNotice.style.display = 'block'; } if (window.Worker) { try { const workerBlob = new Blob([summarizerWorkerScript], { type: 'application/javascript' }); const workerUrl = URL.createObjectURL(workerBlob); state.summarizerWorker = new Worker(workerUrl); const learnedKeywords = JSON.parse(localStorage.getItem('learnedKeywords')); if (learnedKeywords) { state.summarizerWorker.postMessage({ type: 'update_keywords', payload: { keywords: learnedKeywords }}); } } catch (e) { console.error("Failed to create worker:", e); } } else { console.warn('Web Workers are not supported in this browser.'); } setupEventListeners(); });
    </script>
</body>
</html>
